# Deployment Guide - Render

This guide explains how to deploy the Travel Operations Backend to Render.

## Prerequisites

1. A Render account (sign up at https://render.com)
2. A GitHub/GitLab repository with this code
3. Supabase project with database configured

## Option 1: Deploy Using render.yaml (Recommended)

### Step 1: Push Code to Git Repository

```bash
git init
git add .
git commit -m "Initial commit"
git remote add origin <your-repo-url>
git push -u origin main
```

### Step 2: Deploy on Render

1. Go to https://dashboard.render.com
2. Click "New +" and select "Blueprint"
3. Connect your GitHub/GitLab repository
4. Render will automatically detect the `render.yaml` file
5. Click "Apply" to create the service

### Step 3: Configure Environment Variables

After the blueprint is applied, go to your service settings and add these environment variables:

- `SUPABASE_URL`: Your Supabase project URL
- `SUPABASE_ANON_KEY`: Your Supabase anonymous key
- `FRONTEND_URL`: Your frontend URL (e.g., https://yourapp.com)
- `JWT_SECRET`: Will be auto-generated by Render

## Option 2: Manual Deployment

### Step 1: Create New Web Service

1. Go to https://dashboard.render.com
2. Click "New +" and select "Web Service"
3. Connect your repository
4. Configure the service:
   - **Name**: travel-ops-backend
   - **Region**: Oregon (US West)
   - **Branch**: main
   - **Runtime**: Node
   - **Build Command**: `npm install && npm run build`
   - **Start Command**: `npm run start:prod`
   - **Plan**: Free (or choose your preferred plan)

### Step 2: Add Environment Variables

Add the following environment variables in the "Environment" section:

```
NODE_ENV=production
PORT=10000
SUPABASE_URL=<your-supabase-url>
SUPABASE_ANON_KEY=<your-supabase-anon-key>
FRONTEND_URL=<your-frontend-url>
JWT_SECRET=<generate-a-secure-random-string>
```

### Step 3: Configure Health Check

- **Health Check Path**: `/api/v1/health`

### Step 4: Deploy

Click "Create Web Service" and wait for the deployment to complete.

## Post-Deployment

### 1. Verify Deployment

Once deployed, your API will be available at:
```
https://travel-ops-backend.onrender.com
```

Test the health endpoint:
```bash
curl https://travel-ops-backend.onrender.com/api/v1/health
```

### 2. Access API Documentation

Visit the Swagger documentation at:
```
https://travel-ops-backend.onrender.com/api/docs
```

### 3. Update CORS Settings

Make sure to update your frontend URL in the environment variables so CORS is properly configured.

## Environment Variables Reference

| Variable | Description | Required | Example |
|----------|-------------|----------|---------|
| `NODE_ENV` | Environment mode | Yes | `production` |
| `PORT` | Server port (Render uses 10000) | Yes | `10000` |
| `SUPABASE_URL` | Supabase project URL | Yes | `https://xxx.supabase.co` |
| `SUPABASE_ANON_KEY` | Supabase anonymous key | Yes | `eyJhbGc...` |
| `FRONTEND_URL` | Frontend application URL | Yes | `https://yourapp.com` |
| `JWT_SECRET` | Secret key for JWT tokens | Yes | `your-secret-key` |

## Troubleshooting

### Build Failures

If the build fails, check:
1. All dependencies are listed in `package.json`
2. TypeScript compiles without errors locally: `npm run build`
3. Node version compatibility (Render uses Node 18+ by default)

### Runtime Errors

If the service crashes:
1. Check the logs in Render dashboard
2. Verify all environment variables are set correctly
3. Ensure Supabase credentials are valid
4. Check that the health endpoint responds: `/api/v1/health`

### Free Tier Limitations

Render's free tier has some limitations:
- Services spin down after 15 minutes of inactivity
- First request after spin-down may take 30-60 seconds
- Upgrade to paid plan for always-on service

## Automatic Deployments

Render automatically deploys when you push to your main branch:

```bash
git add .
git commit -m "Update backend"
git push origin main
```

The deployment will start automatically and you can monitor progress in the Render dashboard.

## Custom Domain (Optional)

To use a custom domain:
1. Go to your service settings
2. Click "Custom Domain"
3. Add your domain and configure DNS as instructed

## Database Migrations

If you need to run database migrations:
1. Add a migration script to `package.json`
2. Update the build command in `render.yaml`:
   ```yaml
   buildCommand: npm install && npm run build && npm run migrate
   ```

## Support

For issues with Render deployment:
- Render Documentation: https://render.com/docs
- Render Community: https://community.render.com

For application-specific issues, check the logs in the Render dashboard.
